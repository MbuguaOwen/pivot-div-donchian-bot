run:
  mode: live         # paper | live
  timeframe: "15m"
  trading_window:
    enabled: true              # block trades outside this window (uses local tz below)
    start_local: "9:00"       # London+NY overlap start in Nairobi time
    end_local: "01:00"         # midnight (next day) in Nairobi time
    tz_offset_hours: 3         # Nairobi = UTC+3
    label: "Nairobi"

exchange:
  market_type: futures # futures | spot
  testnet: false
  recv_window_ms: 5000

execution:
  mode: paper   # paper | binance
  paper:
    fee_bps: 4.0
    slippage_bps: 1.5
    fill_policy: next_tick   # next_tick | bar_close_fallback
    max_wait_ms: 3000
    use_mark_price: false
    log_trades: true

universe:
  dynamic: false
  quote_asset: "USDT"
  pair_overrides_dir: "configs/pairs"
  max_symbols: 20       # cap dynamic selection to avoid runaway subscriptions
  allow_bases: []   # ignored when dynamic=false
  symbols:
    - XRPUSDT
    - ADAUSDT
    - DOGEUSDT
    - TRXUSDT
    - LINKUSDT
    - DOTUSDT
    - AVAXUSDT
    - LTCUSDT
    - ATOMUSDT
    - NEARUSDT
    - UNIUSDT
    - BCHUSDT
    - BTCUSDT
    - ETHUSDT
    - SOLUSDT
    - BNBUSDT
    - XLMUSDT
    - OPUSDT
    - ARBUSDT
    - APTUSDT

strategy:
  direction: "both"   # both | long_only | short_only
  donchian:
    length: 120
    extreme_band_pct: 0.10
  pivot:
    length: 5
  oscillator:
    ema_length: 14
  divergence:
    # pine (default): EMA((close-open)*volume, oscLen)
    # cvd: bar-close CVD (from aggTrades)
    # both: require pine AND cvd divergence to agree
    # either: pine OR cvd divergence
    mode: "pine"
  fire_on_close_only: true
  kill_switches:
    enabled: true
    mode: filter           # off | shadow | filter
    missing_policy: pass   # pass | fail
    feature_config:
      atr_len_15m: 24
      liq_lookback_bars: 240
      liq_min_samples: 30
      cache_size: 50
    rules:
      - name: short_too_wide_don
        side: SHORT
        all:
          - feature: don_width_atr
            op: ">"
            value: 16.7
      - name: long_thin_liquidity
        side: LONG
        all:
          - feature: liq_pct_15m
            op: "<="
            value: 0.40

parity:
  mode: true
  ema_seed_mode: "sma"   # "first" (default) | "sma" (Pine-style seed)
  pivot_tie_break: "tv_like" # tie-break when equal highs/lows inside window
  warmup_bars: 0
  gap_heal: true
  desync_pause: true

risk:
  engine:
    enabled: true

    # 1) Structure stop
    htf_interval: "1h"
    htf_lookback_bars: 72
    buffer_bps: 10          # structure buffer

    # 2) Cap stop if structure is huge
    atr_len: 24
    # Minimum R distance as % of entry (bps). Prevents toy-tight stops in low vol.
    atr_floor_bps: 15
    k_init: 15.8             # cap = 1.8 * ATR(1h,24)

    # 3) Fixed RR take-profit
    tp_r_mult: 200.0          # TP = 2R

    # 4) Break-even
    be_trigger_r: 1.0
    be_buffer_bps: 10

    # 5) Optional trailing (OFF by default)
    trailing:
      enabled: true
      trigger_r: 2.0
      k_trail: 15.6
      lock_r: 0.5

    min_stop_replace_interval_sec: 2
    min_stop_tick_improvement: 2

orders:
  # Position sizing: simplest is fixed notional in USDT (converted to quantity).
  notional_usdt: 25.0
  # For futures you can also set leverage (bot will try to set it)
  leverage: 3
  # Market orders are simplest/most robust
  order_type: MARKET

position:
  one_position_per_symbol: true
  allow_flip: false        # if true, closes and reverses on opposite signal

limits:
  max_positions_total: 20
  cooldown_minutes_per_symbol: 30

telegram:
  enabled: true
  parse_mode: "HTML"
  branding: "Pivot Div + Donchian"
  heartbeat_enabled: true
  # Optional: override heartbeat interval (seconds) for Telegram status pings.
  # Defaults to run.heartbeat_seconds if unset.
  heartbeat_seconds: 43200
  controls_enabled: false
  # If unset, will use TELEGRAM_CHAT_ID from env
  controls_allowed_chat_id: null
  controls_state_path: "state/telegram_controls.json"

tv_bridge:
  enabled: false
  host: "0.0.0.0"
  port: 9001
  path: "/tv"
  # Provide TV webhook secret via env (recommended)
  secret_env: "TV_WEBHOOK_SECRET"
  # modes: tv_only | tv_and_bot
  mode: "tv_only"
  # How long to wait for the other side in tv_and_bot / parity checks
  match_window_ms: 120000
  alert_on_mismatch: true
  require_tf_match: false

# CVD pressure confirmation (signed delta) - independent of divergence mode
cvd:
  mode: "filter"                 # off | shadow | filter
  delta_window_minutes: 15
  signed_delta_threshold: 50
  warmup_minutes: 60

healthcheck:
  enabled: false
  # Default hits the local tv_bridge /health endpoint over loopback
  url: "http://127.0.0.1:9001/health"
  interval_seconds: 60
  timeout_seconds: 5
  alert_on_failure: true
  alert_on_recovery: true

storage:
  out_dir: "artifacts"

logging:
  level: "${LOG_LEVEL:INFO}"
